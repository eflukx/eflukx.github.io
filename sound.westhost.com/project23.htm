<!doctype html public "-//w3c//dtd html 4.0 transitional//en">
<html>
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
   <meta name="Author" content="Rod Elliott">
   <meta name="description" content="ESP Project Pages - Power Amp Clipping Indicator. See exactly when your power amplifier is reaching the maximum output level">
   <!-- ESP Project Pages - Power Amp Clipping Indicator. See exactly when your power amplifier is reaching the maximum output level -->
   <!-- Updated 07 Oct 2002; reformatted, added additional comments about clipping, added CSS -->
   <meta name="keywords" content="audio,project,diy,amp,preamp,clipping,distortion,indicator,test,circuit,schematic,diagram">
   <title>Power Amp Clipping Indicator</title>
   <link rel="StyleSheet" href="esp.css" type="text/css" media="screen, print">
   <style TYPE="text/css"><!-- td { font-size: 10pt } --> </style>
	<link rel="shortcut icon" type="image/ico" href="favicon.ico">
</head>
<body text="#000000" bgcolor="#FFFFFF" link="#0000EE" vlink="#551A8B" alink="#FF0000">
<table width="100%"><tr><td><img SRC="esp.jpg" alt="ESP Logo" height=81 width=215>
<td align="right">

<script type="text/javascript"><!--
google_ad_client = "pub-1947877433449191";
/* 468x60, created 20/08/10 */
google_ad_slot = "7119701939";
google_ad_width = 468;
google_ad_height = 60;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>

</td></table>

<table WIDTH="100%" BGCOLOR="blue">
<tr><td class="hdrl">&nbsp;Elliott Sound Products</td>
<td ALIGN=RIGHT class="hdrr">Project 23&nbsp;</td>
</tr></table>

<p align="center"><b>Power Amplifier Clipping Indicator</b><br />
<small>Design By Rod Elliott - ESP<br />
Updated 05 May 2005</small></p>

<!-- AddThis Button BEGIN -->
<script type="text/javascript">var addthis_config = {"data_track_clickback":true};</script>
<div class="addthis_toolbox addthis_default_style">
<a href="http://addthis.com/bookmark.php?v=250&amp;username=rode" class="addthis_button_compact">Share</a>
<span class="addthis_separator">|</span>
<a class="addthis_button_facebook"></a>
<a class="addthis_button_myspace"></a>
<a class="addthis_button_google"></a>
<a class="addthis_button_twitter"></a>
</div>
<script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js#username=rode"></script>
<!-- AddThis Button END -->

<hr><b>Introduction</b>
<p>At some stage, we will all find ourselves pushing hi-fi equipment just a little too hard,  and if lucky, will just find that the sound has become "dirty". If this happens too often or is too severe, tweeters are the first to go - they are damaged by the excessive power generated by  a combination of "power compression" and the harmonics created when an amplifier clips. The same may well happen to one's ears, but the effect is much more subtle (and cannot be fixed !).</p>

<p>One of the problems is that short duration clipping is very hard to detect by listening alone, but is still capable of causing damage - especially to tweeters, and it does nothing for the sound quality.</p>

<p>What is needed is a simple and reliable way of detecting that the amplifier is clipping (or so close that we have no margin for error). Well, search no more, because here it is.</p>

<hr><b>Design Considerations</b>
<p>Many clipping detector circuits have been published over the years, but most of them rely solely on an attenuated (reduced) version of the output signal, supplied to a suitable comparator circuit.</p>

<p>This would be fine if the mains voltage stayed exactly the same at all times, and if the power supply had perfect regulation. The fact is that neither of these is true, and the amplifier's DC supply voltage can vary quite considerably from hour to hour, and even minute by minute.</p>

<p>The clipping detector shown here relies on one factor - how close to the supply voltage is the amplifier's output signal at any instant in time. If (when) the supply voltage varies, the detector varies along with it, and will detect even a very short peak that crosses the detection threshold. (See <a href="#how_works">How It Works</a>, below.)</p>

<hr><b>The Clipping Detector</b>
<p>Figure 1 shows the circuit of the detector. Although a simple circuit, it uses a principle of  operation that will be new to many readers. Indeed, it is new to me as well, since this is a method of detection I have never seen published in this form. There was one detector published many years ago that was similar in some respects (this was pointed out by a reader after this circuit was published), but it was dramatically more complex and included extra functionality that (IMO) is best kept separate.</p>

<p align="center"><img SRC="p23_fig1.gif" ALT="Figure 1" BORDER="1"><br>
<b><small>Figure 1 - The clipping Detector Circuit</small></b></p>

<p>The terminal marked 'External" is to allow additional channels to use the same pulse stretch circuit, making it possible to have multiple detectors (even using different amp supply voltages), all sharing a common clipping LED.</p>

<table WIDTH="100%"><tr><td><img SRC="opamp.gif"></td>
<td valign="top"><font size="+0">The pinout for a typical dual opamp is shown for reference. This is pretty much an industry standard, and nearly all dual opamps use this pin configuration. As always, I suggest that you download the data sheet for the device you intend to use to double check. The +ve supply in this circuit is from the 12V zener, and the -ve supply goes to earth. A dual supply is not needed in this application.</font></td></tr></table>

<p>Q1 and Q2 are the detectors, and we can examine the operation of Q1 (the positive peak detector) - Q2 is identical, and detects the negative peak.</p>

<p>During normal operation (not clipping), Q1 is turned on continuously. A reference voltage (typically 3 Volts) is created across the 1k emitter resistor by the resistor shown as "See Table 2". Now if the output of either channel rises close enough to the supply voltage to equal the reference voltage, Q1 is turned off by forcing the base voltage to be greater than the emitter voltage - no base current, so the transistor will not conduct. This is detected by the opamp U1A. This is connected in such a way as to detect either of the transistors turning off.</p>

<p>The "pulse stretch" circuit will detect a clipping period as short as 120us, but reliable detection will take place within 1ms with any program material. Because of the rapid response and deliberate sensitivity to supply voltage variations, this is possibly the most reliable and accurate clipping published to date.</p>

<p>The transistors must be rated for the supply voltage. For most systems (less than +/- 70V) BC639 - NPN (Q2) and BC640 - PNP (Q1) will work happily. They are over the top in power and current ratings, but we need the 80V rating. I do not know of suitable (readily available) devices for use at higher voltages.</p>

<p>There is no need to use fast comparators (you can if you want to), so U1 can be a very basic (and very cheap) LM1458 dual opamp or similar. Please refer to the link on the projects index page to obtain a data sheet for this device - this includes pinouts and other useful information.</p>

<p>The circuit diagram was updated (05 May 05) to improve the detection. The 100k - 27k divider at the input to U1B used to use 100k - 18k, but this was too close to the threshold for typical opamps, resulting in erratic operation at higher than ambient temperatures. The reader who alerted me to this said that the change from 18k to 27k (he used 25k) worked perfectly.</p>

<p align="center">
<table width="640" border=1 style="border-collapse: collapse">
<colgroup span=3 width="33%">
<tr><td><b>Supply Volts</b></td><td><b>Resistor Value</b></td>
<td><b>Power Rating</b></td></tr>
<tr><td>+/- 20</td><td>390 Ohm</td><td>0.5 Watt</td></tr>
<tr><td>+/- 30</td><td>820 Ohm</td><td>0.5 Watt</td></tr>
<tr><td>+/- 35</td><td>1k Ohm</td><td>1 Watt</td></tr>
<tr><td>+/- 40</td><td>1.2k Ohm</td><td>1 Watt</td></tr>
<tr><td>+/- 50</td><td>2.2k Ohms</td><td>2 Watts</td></tr>
<tr><td>+/- 60</td><td>2.7k Ohms</td><td>2 Watts</td></tr>
<tr><td>+/- 80</td><td>3.3k Ohms</td><td>2 Watts</td></tr>
</table>
<b><small>Table 1 - Resistor Value For Power Supply</small></b>

<p>Table 1 is used to select the value and power rating of the "dropper" resistor, based on the power  amp supply voltage. Intermediate supply voltages should use the value for the next lowest supply voltage. A resistor with a higher rating than that shown will reduce temperature and increase reliability.</p>

<p>To calculate the value, I have chosen 20mA as the Zener + opamp current, so ...</p>

<blockquote>Resistor (k Ohms) = ( Supply Voltage - 12 ) / 20 [1]<br>
Power (mW) = ( Supply Voltage - 12 ) ^2 / Resistor (k Ohms) [2]<br><br>
For a 45 Volt supply, we get ...<br><br>
From [1] Resistor = ( 45 - 12 ) / 20 = 33 / 20 = 1.65k Ohms<br>
From [2] Power = (45 - 12 ) ^ 2 / 1.65 = 33 ^2 / 1.65 = 1089 / 1.65 = 660 mW</blockquote>

<p align="center">
<table width="640" border=1 style="border-collapse: collapse">
<colgroup span=3 width="33%">
<tr><td><b>Supply Voltage</b></td><td><b>Resistor Value</b></td><td><b>Power Rating</b></td></tr>
<tr><td>+/- 20</td><td>12k</td><td>0.25 W</td></tr>
<tr><td>+/- 30</td><td>18k</td><td>0.5 W</td></tr>
<tr><td>+/- 35</td><td>22k</td><td>0.5 W</td></tr>
<tr><td>+/- 40</td><td>25k</td><td>0.5 W</td></tr>
<tr><td>+/- 50</td><td>33k</td><td>0.5 W</td></tr>
<tr><td>+/- 60</td><td>39k</td><td>0.5 W</td></tr>
<tr><td>+/- 70</td><td>47k</td><td>1 W</td></tr>
<tr><td>+/- 80</td><td>51k</td><td>1 W</td></tr>
</table>
<b><small>Table 2 - Resistor Value For 3V Clipping Reference</small></b>

<p>The table is fairly accurate for a 3V clipping reference, but some amps will not be capable of  getting to within 3V of the supply (MOSFET types in particular). In these cases, the resistor value must be calculated.</p>

<blockquote>Current (mA) = Reference Voltage - So a 3V reference requires 3mA [4]<br>
Resistor (k Ohms) = ( ( Supply V - Reference V ) / Current (mA) ) * 2 [5]<br>
Power (mW) = Current ^ 2 * Resistor [6]<br><br>
An example would be an amp with 45V supplies, and requiring a reference voltage of 5V. So ...<br><br>
From [4] Current = 5mA<br>
From [5] Resistor = ( ( 45 - 5 ) / 5 ) * 2 = ( 40 / 5 ) * 2 = 16k Ohms<br>
From [6] Power = 5 ^ 2 * 16 = 25 * 16 = 400 mW</blockquote>

<p>Finally, we must select the resistor for the opamp sense inputs. This is required because the voltage on the inverting input must be more positive than that on the non-inverting input for normal operation. The range is quite wide, but not sufficiently so as to cover the entire supply voltage range.</p>

<p align="center">
<table width="640" border=1 style="border-collapse: collapse">
<colgroup span=26 width="50%">
<tr><td><b>Supply Voltage</b></td><td><b>Resistance</b></td></tr>
<tr><td>+/- 20</td><td>33k</td></tr>
<tr><td>+/- 30</td><td>27k</td></tr>
<tr><td>+/- 35</td><td>22k</td></tr>
<tr><td>+/- 40</td><td>18k</td></tr>
<tr><td>+/- 50</td><td>15k</td></tr>
<tr><td>+/- 60</td><td>12k</td></tr>
<tr><td>+/- 70</td><td>10k</td></tr>
<tr><td>+/- 80</td><td>10k</td></tr>
</table>
<b><small>Table 3 - Opamp Input Resistors</small></b>

<p>If the correct value is not used for the power supply voltage, the opamp comparator may hold its output high all the time, which will keep the clipping LED turned on. These resistors can be 0.25 Watt for all supply voltages.</p>

<hr><a NAME="how_works"></a><b>How It Works</b>
<p>Figure 2 shows (in red) the points of the output signal voltage that will trigger the detectors. +ve is the positive power supply voltage and ref+ is the positive reference voltage. The same is applied to the negative supply.</p>

<p align="center"><img SRC="p23_fig2.gif" ALT="Figure 2" BORDER="1">
<br><b><small>Figure 2 - Instantaneous Voltage Detection</small></b></p>

<p>Figure 2A shows the effect as the power supply collapses under sustained load. If the signal drops to a lower level before the supply collapses, the circuit will not be triggered. 2B shows how even the ripple on the power supply is used as a part of the reference, and so will detect that the output signal is about to be clipped based on the supply voltage at any instant in time.</p>

<p>So, as you can see, the actual instantaneous value of the power supply voltage is used as the final reference - the output is measured against this by Q1 and Q2. If the power supply voltage rises or falls, if there is ripple on the supply, this circuit will still indicate if the output of either amp of the stereo pair comes within 3 Volts of the <i>instantaneous</i> value of the power supply voltage (or other value - use formulae 4, 5 and 6 to calculate the reference voltage and required resistor values).</p>

<p>U1A operates as a dual comparator - if either transistor stops conducting, the output goes from around 0V to almost the full supply (12V - regulated with a simple zener). This voltage is applied to the inverting input of U1B, and the capacitor is used to "stretch" the pulse so that even momentary clipping will be seen. This opamp drives the clipping LED directly.</p>

<p>By using the input "A", additional separate amplifiers can be connected, so that in a home theatre system, all 5 (or 6) power amps can be monitored, and a single LED will indicate if any amp clips. This can also be done for bi-amped systems.</p>

<p><b>Note:</b> It is vitally important that outputs from amplifiers with separate power supplies are monitored by their own transistor pair - this ensures that each amp is compared to its own power supply (as it should be). <i>Do not be tempted to try to have one set of detector transistors for multiple separate power supplies.</i></p>

<p>Where a common power supply is used for multiple amplifiers (such as in a home theatre system), additional inputs can be added to the detectors - two diodes and a 1k resistor for each amp.</p>


<hr />
<center>&nbsp;
<script type="text/javascript"><!--
google_ad_client = "pub-1947877433449191";
/* 468x60, created 20/08/10 */
google_ad_slot = "7119701939";
google_ad_width = 468;
google_ad_height = 60;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</center>

<hr /><a href="projects.htm" OnMouseOver="document.b1.src='arrow.gif';" OnMouseOut="document.b1.src='a1.gif';">
<img src="a1.gif" name="b1" alt="Index" border=0 height=24 width=40></a><b>Projects Index</b>
<br><a href="index2.html" OnMouseOver="document.b3.src='a.gif';" OnMouseOut="document.b3.src='a1.gif';">
<img src="a1.gif" name="b3" alt="ESP Home" border=0></a><b>Main Index</b><br /><br />

<table BORDER BGCOLOR="black">
<tr><td class="t-wht"><a id="copyright"></a><b>Copyright Notice.</b> This article, including but not limited to all text and diagrams, is the intellectual property of Rod Elliott, and is Copyright &copy; 1999. Reproduction or re-publication by any means whatsoever, whether electronic, mechanical or electro- mechanical, is strictly prohibited under International Copyright laws. The author (Rod Elliott) grants the reader the right to use this information for personal use only, and further allows that one (1) copy may be made for reference while constructing the project. Commercial use is prohibited without express written authorisation from Rod Elliott.</td></tr></table>
<div class="t-sml">Updates: 05 May 05 - changed resistor value to allow more reliable detection at higher temperatures.</div>
</body>
</html>
