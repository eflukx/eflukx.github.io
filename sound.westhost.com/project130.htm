<!DOCTYPE doctype PUBLIC "-//w3c//dtd html 4.0 transitional//en">
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
	<meta name="Author" content="Rod Elliott - Elliott Sound Products">
	<meta name="keywords" content="sound, level, spl, a-weighting, filter, noise, measurement, audio, project, diy, circuit, schematic, diagram">
	<meta name="description" content="ESP Audio Projects - Inverse A-Weighting Filter/ Amplifier. Get the original signal back again with this interesting filter.">
	<!-- ESP Audio Projects - Inverse A-Weighting Filter/ Amplifier. Get the original signal back again with this interesting filter. -->
	<title>Inverse A-Weighting</title>
	<link rel="StyleSheet" href="esp.css" type="text/css" media="screen, print">
	<style TYPE="text/css"><!-- td { font-size: 10pt } th { font-size: 10pt } --> </style>
	<link rel="shortcut icon" type="image/ico" href="favicon.ico">
</head>
<body text="#000000" bgcolor="#FFFFFF" link="#0000EE" vlink="#551A8B" alink="#FF0000">
<table width="100%"><tr><td><img SRC="esp.jpg" alt="ESP Logo" height=81 width=215>
<td align="right" class="tap" valign="bottom">The Audio Pages</td></table>

<table WIDTH="100%" BGCOLOR="blue"><tr><td class="hdrl">&nbsp;Elliott Sound Products</td>
<td ALIGN=RIGHT class="hdrr">Project 130&nbsp;</td></tr></table>

<p align="center"><b>Inverse A-Weighting Filter/ Amplifier</b><br />
<small>Rod Elliott (ESP)</small></p>

<!-- AddThis Button BEGIN -->
<script type="text/javascript">
var addthis_config = {
    data_track_clickback: true
}
</script>

<script type="text/javascript">var addthis_config = {"data_track_clickback":true};</script>
<div class="addthis_toolbox addthis_default_style">
<a href="http://addthis.com/bookmark.php?v=250&amp;username=rode" class="addthis_button_compact">Share</a>
<span class="addthis_separator">|</span>
<a class="addthis_button_facebook"></a>
<a class="addthis_button_myspace"></a>
<a class="addthis_button_google"></a>
<a class="addthis_button_twitter"></a>
</div>
<script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js#username=rode"></script>
<!-- AddThis Button END -->

<!--
<hr><img src="pcb.gif" alt="" width="33" height="26">
<img src="filler.gif" alt="" width="32" height="8">
<small><b>PCBs will be available for this project soon</b></small><br>
-->

<hr><b>Introduction</b>
<p>To be perfectly honest, I have no idea why anyone would want an inverse or reverse A-weighting filter. The idea came up though, and it appears that no-one has produced such a beast, especially as a DIY project. It's even conceivable that it doesn't exist at all, which wouldn't surprise me because it does have very limited usefulness.

<p>A-Weighting is traditionally used for all noise measurements, even though it is utterly unsuitable for any noise that has deep bass, is cyclic in nature or has any degree of tonality. Measurements in dBA have been with us for a long time, but far too few people have ever seriously questioned the use of such a radical filter. It turns out that you can add some filtered deep bass that is <i>clearly</i> audible and would be extremely annoying if one were trying to sleep, yet it doesn't register ... <u>at all</u> ... on a sound level meter set to measure dBA (sound pressure level, A-Weighted).

<p>Based on some initial tests I did, further testing was undertaken at a New Zealand university. This backed up my findings completely, and showed that increasing the level of a very irritating modulated bass tone (40Hz) in the midst of band limited white noise didn't show up on the sound level meter. The dB column is an essentially flat reading (no filter), and dBA is the A-Weighted measurement.</p>

<center><table width="640" border=1 style="border-collapse: collapse">
<tr><td><b>White Noise Plus ...</b><td width="20%"><b>dB</b><td width="20%"><b>dBA</b>
<tr><td>40Hz Amplitude Modulated at 0.5Hz, Just Audible<td>70.8<td>65.4
<tr><td>40Hz Amplitude Modulated at 0.5Hz,  +10dB<td>77.6<td>65.4
<tr><td>40Hz Amplitude Modulated at 0.5Hz, +15dB<td>82.2<td>65.5
</table><b><small>Table 1 - Sound Level Meter Readings</small></b></center>

<p>As you can see from the above, even when the 40Hz modulated tone was increased by 15dB from the "just audible" level, an A-weighted measurement shown no increase. The tone is <i>very</i> audible above the white noise, and it shows up clearly on a spectrum analyser. The meter says there's nothing at all with A-weighting, but shows a definite increase when set to flat. Can you imagine how annoying it would be if you complained to the "authorities" about a noise, and some lunatic points to his meter and says "There's nothing there - it's fine, and there's nothing we can do." - even though <i>both of you can hear it plainly</i>. Sadly, exactly this scenario is played out regularly, and wind farms are a major culprit.</p>

<hr><b>Description</b>
<p>For anyone who doesn't know what an A-Weighting curve is or how it's created, have a look at <a href="project17.htm" target="_blank">Project 17</a>. It's alleged that the curve is roughly the inverse of the 30 phon (30dB SPL) curve of the traditional Fletcher-Munson "equal loudness" curves, but it's arguably actually closer to the 20dB SPL level. This is an unrealistically low sound level, and one that (sadly) very few people will experience for 99% of their lives.

<p>The biggest problem with trying to reverse the filter is the amount of gain needed at low frequencies. A full 50dB of gain is needed at 20Hz, and a lot more at lower frequencies. Frequencies below 20Hz can still be well within the threshold of <i>feeling</i>, even though they are theoretically inaudible.</p>

<center><img src="p130-f1.gif" border="1" alt="Figure 1"><br><b><small>Figure 1 - Schematic Of Reverse A-Weighting Filter</small></b></center>

<p>The input signal must be from a low impedance source, because R1, C1 and R2 form the first pole of the filter. The networks around U1A and U1B provide the remainder of the correction. It may be somewhat surprising that considerably more circuitry is needed to reverse the A-Weighting curve than is needed to create it in the first place, but it's all about the gain. 50dB at 20Hz is a gain of 316 - not a major problem in itself, but trying to reverse the passive filter with active circuits is not easy.

<p>It simply cannot be achieved with a single opamp because of the massive phase shift (which would cause a single stage to oscillate), and a passive version can't be used because there would be too much noise in the output signal. The circuit shown will hardly be silent either - some circuit and opamp noise is inevitable with well over 60dB of total gain available.</p>

<center><img src="p130-f2.gif" border="1" alt="Figure 2"><br><b><small>Figure 2 - A-Weighting Curve (Green) And Reversed Response (Red) </small></b></center>

<p>The red trace shows the final response, after the input signal has been processed by an A-Weighting filter (green trace). It is not perfect, but is a reasonable compromise across the audio band. Across the range of 50Hz to 10kHz the net response is within less than 0.25dB referenced to 1kHz, and the total frequency response is within +0.25, -1.5dB from 20Hz to 20kHz.</p>

<center><img src="p130-f3.gif" border="1" alt="Figure 3"><br><b><small>Figure 3 - Error Response, A-Weighted Signal In, Corrected Signal Out</small></b></center>

<p>The graph above shows the magnified error, from 10Hz to 40kHz. Over the full range which is more than covers the audio band, the response is -3dB at 11.3Hz and 30kHz. Worst case positive error is +0.23dB at 110Hz and 0.09dB at 7kHz. It is undoubtedly possible to improve on this, but it would be completely pointless. Note too that the circuit has an overall gain of 1.4dB at 1kHz. If you need exact voltages, then this needs to be trimmed out with an output level preset control.

<p>In use, it is vitally important that the input signal applied has already been filtered with an A-Weighted filter.  The circuit has a huge amount of low frequency gain (see the graph below), and will distort very easily and at quite low levels if a normal unfiltered full-range audio signal is applied.</p>

<center><img src="p130-f4.gif" border="1" alt="Figure 4"><br><b><small>Figure 4 - Response Of Each Section Of Filter</small></b></center>

<p>Above, you can see the accumulated response at the output of each section (sections are as shown in Figure 1). The extreme low frequency gain is very high, so the circuit will take a little while to settle after power is applied or an overload. Note that this graph extends from 0.1Hz (100mHz) to 100kHz. The gain peak is at 1.8Hz, and although it might look excessive it's all needed to get the response shown above. To get <i>flat</i> response down to 10Hz would require even more gain, with the real risk of low frequency oscillation (which is still possible if wiring is incorrectly laid out).

<p>Stage 3 response is the cumulative frequency response of all three stages. Stage 2 actually has the highest gain (around 500 at 1.8Hz). It also has the modest high frequency boost that's needed to counteract the HF rolloff produced by the A-Weighting filter. The expected gain from each stage is well within the normal capabilities of most common opamps, such as the TL072, NE5532 or 4558.</p>

<hr><b>Construction</b>
<p>Much as I'd like to be able to offer a PCB which would make construction trivial, this won't happen. My guess is that engineers across the whole planet will build somewhere between none and 10 of these filters, so a PCB is not warranted. Veroboard or other prototype board will work fine though, although good layout practice will be needed to prevent noise pickup and/ or oscillation. Once the first filter stage (R1, C1 and R2) is out of the equation, the active circuitry has a minimum gain of  5.8 times at 2.4kHz.

<p>Gain at 1.8Hz is at least 25,000 (88dB) and may be much higher... up to about 94dB - a gain of over 50,000 - depending on opamp low frequency open-loop gain. This high gain is necessary to counteract the astonishingly large attenuation of the A-weighting filter at very low frequencies. Power supplies must be well bypassed and very low impedance at low frequencies to prevent low frequency instability (motor-boating). High frequency gain is reasonably tame, and (assuming ideal opamps) can only achieve a gain of about 46 (33dB) at 1MHz.  In reality it will be less than this because of the opamp's frequency compensation.

<p>Component values are fairly critical, so resistors and capacitors (with the exception of C2 and C5) must be within 1% tolerance. It's a lot cheaper to buy normal caps and select them than to purchase 1% versions, as they are normally prohibitively expensive.

<p>Note that power supply pins are not shown in Figure 1. The supplies are shown in the opamp diagram below, and supply voltage will normally range from about &plusmn;12V to &plusmn;15V.</p>

<table border="0" width="100%"><tr>
<td valign="top"><img src="opamp.gif"></td><td valign="top"><p>The standard pinout for a dual opamp is shown on the left. If the opamp is installed backwards, it will almost certainly fail, so be careful.</p>
<p>The suggested TL072 opamp will be quite satisfactory for most work, but if you prefer to use ultra low noise devices, that choice is yours. Because of the circuit topology, there is no real need for extremely high input impedance, and the 4558 is an economical choice. The NE5532 is potentially a good choice for low noise applications. You can probably use the LM833 too, but it's one of my least favourite opamps (the reason you don't see it in any of my projects).</p></td></tr></table>

<hr><b>Testing</b>
<p>After the circuit is built, connect to a suitable power supply - remember that the supply earth (ground) must be connected! When powering up for the first time, use 100 ohm "safety" resistors in series with each supply to limit the current in case you have made a mistake in the wiring. Because these resistors will increase the power supply impedance (especially at low frequencies), don't be alarmed if the filter starts to oscillate. This just means that the circuit is working, so the 100 ohm resistors can be removed and the circuit is ready for use.</p>

<hr><small>Note that this circuit is theoretical, is provided as-is, and has been simulated using exact value components. While every care is taken, errors or omissions may be found that may affect the ability of the circuit to function as described. ESP provides this schematic and graphs for information only, and there is no warranty of any kind. You build the circuit entirely at your own risk, and ESP accepts no responsibility for failure of the project to perform as expected.</small><br>

<hr />
<center>&nbsp;
<script type="text/javascript"><!--
google_ad_client = "pub-1947877433449191";
/* 468x60, created 20/08/10 */
google_ad_slot = "7119701939";
google_ad_width = 468;
google_ad_height = 60;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</center>

<hr /><a href="projects.htm" OnMouseOver="document.b1.src='arrow.gif';" OnMouseOut="document.b1.src='a1.gif';">
<img src="a1.gif" name="b1" alt="Index" border=0 height=24 width=40></a><b>Projects Index</b>
<br><a href="index2.html" OnMouseOver="document.b3.src='a.gif';" OnMouseOut="document.b3.src='a1.gif';">
<img src="a1.gif" name="b3" alt="ESP Home" border=0></a><b>Main Index</b><br /><br />

<table BORDER BGCOLOR="black">
<tr><td class="t-wht"><a id="copyright"></a><b>Copyright Notice.</b>This article, including but not limited to all text and diagrams, is the intellectual property of Rod Elliott, and is Copyright &copy; 2010. Reproduction or re-publication by any means whatsoever, whether electronic, mechanical or electro-mechanical, is strictly prohibited under International Copyright laws. The author (Rod Elliott) grants the reader the right to use this information for personal use only, and further allows that one (1) copy may be made for reference while constructing the project. Commercial use is prohibited without express written authorisation from Rod Elliott.</td></tr>
</table>
<div class="t-sml">Page Created and Copyright &copy; Rod Elliott 22 May 2010</div>
</body>
</html>
