<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang="ja">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=Shift_JIS">
<meta http-equiv="Content-Style-Type" content="text/css">
<link rel="start" title="Site Top" href="../../index_j.html">
<link rel="up" title="Tech Notes" href="../../cc.html">
<link rel="stylesheet" href="../junk.css" type="text/css" media="screen" title="ELM Default">
<style type="text/css" media="screen" title="ELM Default">
#smf {color: aquamarine; font-size: smaller;}
</style>
<title>STN液晶モジュールの食べ方</title>
</head>

<body>
<div class="header">
<p class="hdh"><a href="http://elm-chan.org/"><img src="../../p/header.png" alt="ELM Home Page" width="400" height="27"></a></p>
<h1>STN液晶モジュールの食べ方</h1>
<p class="hdd"><br>2003. 11. 2</p>
<hr class="hds">
</div>

<div class="abst">
<img class="rset" src="lcd1.jpeg" alt="" width="526" height="257">
<p>ジャンクで時々STN液晶モジュールを目にするようになりましたが、今回程度の良いカラー液晶モジュールが手に入ったので、試食してみました。右のIMGに示す、対角4インチ、解像度は320×240ドット、モジュールの厚さ約7mm、CCFLバックライトを内蔵、さらにタブレット付きというシロモノで、PDA向けの液晶モジュールと思われます。STNとかTFTの原理といった液晶一般については、他のサイトを参照してください。</p>
</div>


<div class="para">
<h3>STN液晶モジュールの信号</h3>
<img class="rset" src="lcd1.png" alt="" width="325" height="505">
<p>巷でよく見かけるSTN液晶モジュールは大体右に示すような構成になっていて、制御信号もどれも似たものとなっています。図に示したのは、白黒320×240ドット、8ビットシングルI/Fの構成と、先頭ラインの転送タイミングです。次に主な信号とその意味を示します。</p>
<h4>D0..Dn</h4>
<p>ドットデータ入力。4ビットまたは8ビット単位。特に480ライン以上のSTNカラー液晶パネルでは、駆動デューティを下げてコントラストや応答速度を改善するため、nビット+nビットでそれぞれ液晶パネルの上下半分を同時スキャンするDSTNという2個1タイプのモジュールが多いようです。</p>
<h4>CL2(XSCL)</h4>
<p>ドットデータ（D0..Dn）をカラムドライバに取り込むシフトパルスです。１ライン分の転送に要するサイクル数は、水平ドット数/データ幅ということになります。片エッジのほか、パルスの両エッジでデータを取り込むタイプもあります。</p>
<h4>CL1(LP)</h4>
<p>ラインデータラッチ信号。カラムドライバに取り込まれた1ライン分のデータをラッチする、いわゆる水平同期信号のようなものです。</p>
<h4>FLM(YD)</h4>
<p>フレーム開始信号。CL1(LP)のタイミングで参照され、そのラインがフレームの先頭ラインであることを示す、いわゆる垂直同期信号のようなものです。</p>
<h4>M(MOD)</h4>
<p>液晶パネル駆動波形の極性を選択する信号。1～数フレーム毎に反転させて直流分が液晶パネルに加わらないようにします。最近の液晶モジュールは内部生成で外部からは必要としないものが多いようです。</p>
<h4>DISP(/DISPOFF)</h4>
<p>正しい信号が入力されていないとき、液晶パネルに不正な駆動電圧が加わってダメージを与えるのを防ぐため、ドライバ出力をOFFする信号。表示開始後数フレーム期間経って駆動回路が安定してからONし、信号停止前やシステムリセット時にOFFするなど、液晶パネル保護のため適切に制御する必要があります。多くはLレベルでOFFです。</p>
<h4>V<sub>DD</sub></h4>
<p>ロジック回路電源。昔は5V系、最近は3V系が主流のようです。</p>
<h4>V<sub>EE</sub></h4>
<p>液晶パネル駆動電源。320×240カラーの液晶では+20～+30V程度が多いようで、電流は数mA程度です。駆動電源は内部で分圧されて各駆動レベルが生成されますが、古い液晶モジュールでは個別に与える必要があるものもあります。また、DC-DCコンバータが内蔵され、外部供給を必要としないものもあります。この電圧を変えることによって表示濃度を調整します。</p>
</div>


<div class="para">
<h3>カラーSTN液晶パネル</h3>
<img class="rset" src="lcd2.png" alt="" width="284" height="180">
<p>カラーパネルは、モノクロパネルの水平ドット数を単純に3倍にして、RGBの縦ストライプを印刷したものとなっています。したがって、<em>RGBのドット配列は転送単位に合わない</em>順序になるので、右の図に示すようにRGBデータをうまく並べ替えて転送データの中へ正しくパッキングしてやる必要があります。</p>
</div>


<div class="para">
<h3>STN液晶パネルの多階調表示</h3>
<img class="rset" src="lcd3.png" alt="" width="240" height="220">
<p>STN液晶モジュールに入力される信号には、ドットをON/OFF（2階調）するだけの情報しかありません。これで多階調を実現するには、コントローラ側で<em>3次元(時間軸)ディザリング処理</em>を行う必要があります。具体的には、ドットをONするフレーム数の割合を変えることにより濃度をリニアに制御するのです。例えば、15フレームシーケンスでON/OFF比を制御すれば16階調表示が実現できることになります。STN液晶の応答速度は比較的遅いので速い周期のON/OFFは平均化されますが、ディザパターンの周期が長すぎるとフリッカが感じられるようになるので、16階調程度までが多いようです。</p>
</div>


<div class="para">
<h3>STN液晶モジュールの調理例</h3>
<a class="imglnk" href="lcd2.jpeg"><img class="rset" src="lcd2.jpeg" alt="" width="348" height="285"></a>
<p>さすがにカラー液晶モジュールとなると、RGBのパック化や多階調表示などマイコンで直に駆動するのは困難になってきます。デバオタならここでPLDの類とSRAMを引っ張り出してくるところでしょうけど、手軽にやるには無駄な苦労は避けて専用ICを使うのがスマートと言うものです。ということで、今回は手持ちにあったエプソンの液晶コントローラ <em>S1D13705</em>（旧SED1375）を使ってみました（確か、秋葉で\3k程度だったかな）。これは、各種バスI/F、80KBのSRAM、LUT、汎用LCD I/Fなどを内蔵していて、多くのSTN/TFT液晶モジュールに対応できます。320×240ドットの解像度では4096色中256色の表示が可能です。</p>
<p>リフレッシュ周波数は、液晶の応答速度や階調制御の有無で下限が決まってきます。この液晶モジュールの推奨リフレッシュ周波数は階調制御を考慮してか130Hzとなっていましたが、階調制御しないなら50Hz程度でも使えると思います。<br>
　右のIMGは試しに表示してみたところ。必要な電源はVDDに3.3V、VEEに+23V、それとCCFLの高圧でした。一昔前のTFT並のコントラストが得られるようですが、応答速度はもちろんSTNのトロさです(^_^;。まぁ、階調制御の関係上、あまり速くても困るのですが。さて、何に使おう...</p>
</div>


<div class="para">
<h3>抵抗膜式タブレット</h3>
<img class="rset" src="tab1.png" alt="" width="400" height="240">
<p>PDAに使われているタブレットにはいろいろな方式があると思いますが、この液晶モジュールに取り付けられていたのが<em>抵抗膜式</em>だったので、早速食べてみました。このタイプのタブレットは、構造が単純でマイコンに直結して使えることが特徴です。構造は右のIMGに示すように、透明な導電抵抗膜が蒸着されたガラス板と樹脂フィルムをわずかな隙間をおいて積層したものとなっています。それぞれの抵抗膜には、並行する二辺に電極が設けられ、電流の向きが互いに直交するようになっています。抵抗膜の抵抗値は数100Ωです。</p>
<br>
<img class="lset" src="tab2.png" alt="" width="300" height="400">
<p>定常状態ではそれぞれの抵抗膜は離れていて独立した回路になっています。ここで、樹脂フィルムの左下（＋点）をペンで押さえてみます。するとその点の抵抗膜が接触して、左のIMGの上に示すような回路が形成されます。ポイントされた位置を検出するには、X層に電圧を加えてY層をフローティング状態にしてY層に現れた電圧を測ればX層の座標が分かります。同様にY層の座標も知ることができます。</p>
<p>例として今回の実験回路を図の下側に示します。測りたい層のポートにHとLを出力して電圧を加え、もう一方の層の電圧をA/Dコンバータで測ります。当然ですが、取り込む際は適当な平均化処理でノイズを除去したり、ポイントした座標と実際のドット位置が合うように校正する機能も必要になってきます。このときポートの内蔵プルアップ（抵抗膜より十分に高抵抗）をONにすることによりオープン状態でA/D値が最大となり、押されているかどうかも同時に判断できます。</p>
<br>
<a class="imglnk" href="lcd3.jpeg"><img class="rset" src="lcd3.jpeg" alt="" width="296" height="217"></a>
<p>右のIMGがタブレットを使ってみたところ。これで携帯型お絵かきパッドなんてのを作るのもいいかもしれない...（素直に電子手帳買えって?(^_^;）。</p>
</div>


<p class="foot"><img alt="Sign" src="../../p/sign.png"></p>
</body>
</html>
