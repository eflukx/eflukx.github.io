<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang="ja">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=Shift_JIS">
<meta http-equiv="Content-Style-Type" content="text/css">
<link rel="start" title="Site Top" href="../../index_j.html">
<link rel="up" title="Video" href="../../he_v.html">
<link rel="stylesheet" href="../works.css" type="text/css" media="screen" title="ELM Default">
<title>ELM - 汎用ビデオスーパーインポーザ</title>
</head>

<body>
<div class="header">
<p class="hdh"><a href="http://elm-chan.org/"><img src="../../p/header.png" alt="ELM Home Page" width="400" height="27"></a></p>
<h1>汎用ビデオスーパーインポーザ</h1>
<p class="hdd"><br>1997. 5. 10</p>
<hr class="hds">
</div>

<div class="abst">
<img class="rset" src="sdisp_sample_picture.jpeg" alt="" width="213" height="160">
<p>ビデオテープを整理していて、「ここで注釈などやその映像の付加情報を一緒に記録したいなぁ」と思うことがよくあります。あまり凝ったことはせずに、単に字幕を入れる程度なら簡単にできそうなので試しにやってみることにしました。要は<em>ビデオタイトラー</em>のようなものです。（右の写真は起動時のステータス表示）</p>

<h4>表示機能</h4>
<p>まず、重ね合わせる文字色は白色のみとします。これにより色信号の処理を省ける為、アナログ系が極めて単純になります。また、解像度はメモリ構成の容易さと漢字を表示するのに十分な 512x240フルグラフィックとします。</p>

<h4>再現性</h4>
<p>最初はオンスクリーンディスプレイ用ＩＣを使用して簡単に済まそうと思いましたが、任意のグラフィックを表示できる解像度のものが無いのと、何よりアマチュアがそれらのＩＣを入手するのは困難なため、以前使用した CRTC HD6445で外部同期をかけて使おうとしました。しかし、これも常時在庫する店がほとんど無くなってきているので、再現性を確保するために汎用部品だけで組むことにしました。その方がかえって単純になりましたが(^^;。制御方法としては、各種のボードマイコンを接続してメモリアクセスでビデオバッファを書き換える方式にして、汎用性を高めています。</p>

<h4>高速表示</h4>
<p>文字をスクロールしたときのチラツキや、書き換え動作が見えないようにビデオバッファを高速に書き換えられることが必要です。しかし、表示アクセスと読み書きアクセスの調停がソフトウェアによるブランキング待ちでは、時間のロスが多すぎるので使えません。そこで、表示アクセスの間をぬって読み書きできるようにして、WAIT信号による調停としました。ただし、書き換えのタイミングを得るために垂直同期信号と奇数／偶数フィールド信号はモニタできるようにします。</p>
<br>

<table class="lst">
<caption>スーパーインポーザの仕様と<a href="sdisp.png">回路図</a></caption>
<tr><td>入出力信号</td><td>NTSCコンポジット信号（S信号はオプション）</td></tr>
<tr><td>解像度</td><td>水平 512ドット、垂直 240ライン、白黒</td></tr>
<tr><td>制御I/F</td><td>バス接続(メモリアクセス)、WAIT制御あり</td></tr>
<tr><td>製作費</td><td>部品代 \6,000</td></tr>
</table>
</div>


<div class="abst">
<h3>組み立てと調整</h3>
<img class="rset" src="sdisp_pcb.jpeg" alt="基板" width="213" height="160">
<p>組み立ての際に注意すべき点は、高速ディジタル回路とアナログ回路が同居する場合に一般的なことくらいでしょう。特に微妙な所はないので配線の間違いさえ無ければ一発で動作するはずです。また、この回路では <a href="../../docs/pld.html">PLD</a>を使用していますので、実際に製作する場合、PLDにプログラムできる環境であることが必要です。</p>
<p><em>VR2</em>はスーパーインポーズの垂直位置を調整します。21ライン目から表示がスタートするように調整します。このときのパルス幅は 1.1ms程度になります。</p>
<p><em>VR3</em>はスーパーインポーズの水平位置を調整します。ラスタの表示領域からスタートするように調整します。このときのパルス幅は 8〜10μs程度になります。</p>
<p><em>VR1</em>はスーパーインポーズの明るさを調整します。出力を 75Ωで終端した際に、シンクチップ(同期信号の先端)と文字の間で 1.0Vp-pになるように調整します。</p>
</div>


<div class="abst">
<h3>後から気づいたことなど</h3>

<h4>表示のはみ出し</h4>
<p>ビデオ信号の表示可能領域いっぱいに表示するようにしているので、TVに表示させるとスーパーインポーズ領域の周辺部が画面からはみ出します。このため、字幕がはみ出さないように描画する必要があります。スーパーインポーズの表示サイズをTVの可視領域に合わせたい場合でも、上下方向のサイズを変えることはできません。VR2で上端を合わせることはできますが。横サイズを変化させて合わせるにはマスタークロックを変えることで可能です。20〜25MHzの範囲で調整して見てください（クロックを上げると左右のサイズが縮む）。</p>

<h4>クロック位相のゆらぎ(ジッタ)</h4>
<p>この回路ではPLLを使用せず、ドットクロックは固定クロックとしています。このため、水平同期信号による同期化の際に50ns程度のジッタが発生します。これは水平期間の 1/1300程度となり、普通に見る分には気になりませんが、よく見ると縦線の部分で線が僅かに乱れているのが認識できます。</p>

<h4>文字の視認性</h4>
<p>白一色の表示なので仕方ありませんが、背景が明るいと文字が見難くなります。ドット出力とマルチプレクサの間に入っているディレイ回路は、文字に陰影を付けて見易くするためのもので、後から追加したものです。垂直方向の影も入れられれば良かったのですが、回路が複雑になるので止めました。最初から2bit/pixelにした方が簡単でしょう。</p>

<h4>ドットの形状</h4>
<p>表示領域は512x240、となります(仕様の通りですが)。このため、ドットの形は正方形にはなりません。例えば、正方形の文字を表示するには24x16フォントを使用することになります。ビデオバッファのサイズは512/8x240で16KバイトとなりメモリICを半分しか使っていません。ビデオメモリの1ビットが1ドットに対応し、64バイトで1ラインです。</p>

<h4>垂直解像度の改善</h4>
<p>垂直方向の解像度が240ラインとやや低い。偶数／奇数フィールドに関係なく同じものを表示しているので仕方ないことです。しかし、LM1881NのODD/EVEN出力を表示アドレスの一部として使用する(反転して水平アドレスカウンタと垂直アドレスカウンタの間に挿入)ことにより解像度を 512x480とすることは容易です。この場合、メモリICの容量をフルに使用することになります。</p>

<h4>部品の入手</h4>
<p>全て汎用部品のみを使用しているので、特に入手難なものはないでしょう。秋葉を一巡すれば揃うものばかりです。ビデオバッファに使用している高速SRAMは入手しにくいでしょうけど、これはキャッシュメモリ(45ns以下)を使用するとよいです。</p>
</div>


<div class="abst">
<h3>資料</h3>
<img class="lset" src="sdisp_ctl.jpeg" alt="">
<p><a href="sdisp.png">メインの回路図</a>│<a href="sdisp_svif.png">S-VIDEO接続アダプタ</a>│<a href="sdisp_tc.png">Ｉ／Ｆタイミング</a>│<a href="sd_pld.zip">PLDソースファイル</a>│<a href="s_kc82.png">KL5C8012との接続例</a>│<a href="s_64180.png">HD64180との接続例</a>│<a href="s_v25.png">V25との接続例</a>│<a href="s_isa.png">ISAとの接続例</a>│<a href="s_lpt.png">LPTポートとの接続例</a></p>
<br class="clr">
<img class="lset" src="sdisp_sample_video.jpeg" alt="">
<p><a href="sdisp_sample_video.mpeg">サンプルビデオ(679KB)</a></p></div>

<p class="foot"><img alt="Sign" src="../../p/sign.png"></p>
</body>
</html>
